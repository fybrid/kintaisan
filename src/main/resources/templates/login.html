<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ログイン</title>
</head>
<body>

    <h1>勤怠さん</h1>
    <form id="login-form" th:action="@{/api/signin}" method="post">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
        <p>
          <input type="text" id="username" name="username" placeholder="ユーザーID/ユーザー名" required>
        </p>
    
        <p>
          <input type="password" id="password" name="password" placeholder="パスワード" required>
        </p>

        <p id="login-error" aria-live="polite" style="display:none; color:#c00;"></p>
    
        <p>
          <input type="submit" value="ログイン">
        </p>
    </form>

    <script>
      (function () {
        const form = document.getElementById("login-form");
        const errorEl = document.getElementById("login-error");

        form.addEventListener("submit", async (event) => {
          event.preventDefault();

          errorEl.style.display = "none";
          errorEl.textContent = "";

          const body = new URLSearchParams(new FormData(form));
          const response = await fetch(form.action, {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body,
          });

          if (response.ok) {
            window.location.href = "/";
            return;
          }

          errorEl.textContent = "ユーザーID/ユーザー名、またはパスワードが違います。";
          errorEl.style.display = "block";
        });
      })();
    </script>

</body>
</html>
